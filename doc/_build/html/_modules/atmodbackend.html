<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>atmodbackend &mdash; AtModExplorer 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="AtModExplorer 0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">AtModExplorer 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for atmodbackend</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.widgets</span> <span class="kn">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">matplotlib.axes</span>

<span class="c">#Main imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c">#import pandas as pd</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">pdb</span><span class="o">,</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="c">#sys.path.append(&#39;/home/liamk/mirror/Projects/geospacepy&#39;)</span>
<span class="c">#import special_datetime, lmk_utils, satplottools #Datetime conversion class</span>

<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">textwrap</span> <span class="c">#for __str__ of ModelRun</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span><span class="p">,</span> <span class="n">Normalize</span>
<span class="kn">import</span> <span class="nn">msispy</span><span class="o">,</span><span class="nn">hwmpy</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<div class="viewcode-block" id="ModelRun"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.ModelRun">[docs]</a><span class="k">class</span> <span class="nc">ModelRun</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	The ModelRun class is a generic class for individual calls to atmospheric models.</span>

<span class="sd">	The idea is to have individual model classes subclass this one, and add their specific</span>
<span class="sd">	run code to the &#39;populate method&#39;.</span>

<span class="sd">	**The assumptions are:**</span>
<span class="sd">	</span>
<span class="sd">	* All atmospheric models take as input latitude, longitude and altitude</span>
<span class="sd">	* User will want data on a 2-d rectangular grid or as column arrays</span>

<span class="sd">	**The parameters used:**</span>
<span class="sd">	</span>
<span class="sd">	* **xkey** - string or None</span>
<span class="sd">		The key into vars,lims, and npts for the variable that represents the 1st dimension of the desired output (x-axis)</span>
<span class="sd">	* **ykey** - string or None</span>
<span class="sd">		The key into vars,lims, and npts for the variable that represents the 2nd dimension of the desired output (y-axis)</span>

<span class="sd">	* **vars** - an OrderedDict (Ordered because it&#39;s possible user will always want to iterate in a predetermined order over it&#39;s keys)</span>
<span class="sd">		#. The keys of vars are the names of the data stored in it&#39;s values. </span>
<span class="sd">		#. vars always starts with keys &#39;Latitude&#39;,&#39;Longitude&#39;, and &#39;Altitude&#39;</span>

<span class="sd">	* **lims** - an OrderedDict</span>
<span class="sd">		The range [smallest,largest] of a particular variable that will be used determine:</span>
<span class="sd">		#. The range of values of the independant variables (i.e. Latitude, Longitude or Altitude) the model will generate results format</span>
<span class="sd">		#. The range of values the user could expect a particular output variable to have (i.e to set axes bounds)</span>

<span class="sd">	* **npts** - an OrderedDict</span>
<span class="sd">		#. The number of distinct values between the associated lims of particular input variable that will be passed to the model</span>
<span class="sd">		i.e. (how the grid of input locations will be shaped and how big it will be)</span>

<span class="sd">	* **drivers** - a Dictionary</span>
<span class="sd">		Additional inputs that will be passed to the model (using **self.drivers in the model call).</span>
<span class="sd">		Inititialized to empty, set via the subclass</span>

<span class="sd">	Subclass best practices:</span>
<span class="sd">		* In the subclass __init__ method, after calling the superclass **__init__** method, the user should:</span>
<span class="sd">			* Set any keys in the self.drivers dict that will then be passed a keyword arguments to the model wrapper</span>
<span class="sd">		* In the populate method, after calling the superclass **populate** method, the user should:</span>
<span class="sd">			* Call the model using the flattened latitude, longitude, and altitude arrays prepared in the superclass method,</span>
<span class="sd">			and pass the drivers dict as keyword arguments.</span>
<span class="sd">		</span>
<span class="sd">	**Example for horizontal wind model subclass:**</span>

<span class="sd">	.. code-block:: python</span>
<span class="sd">		</span>
<span class="sd">		def __init__(self):</span>
<span class="sd">			#This syntax allows for multiple inheritance,</span>
<span class="sd">			#we don&#39;t use it, but it&#39;s good practice to use this </span>
<span class="sd">			#instead of ModelRun.__init__()</span>
<span class="sd">			super(HWMRun,self).__init__()</span>
<span class="sd">			#ap - float</span>
<span class="sd">			#	daily AP magnetic index</span>
<span class="sd">			self.drivers[&#39;dt&#39;]=datetime.datetime(2000,6,21,12,0,0)</span>
<span class="sd">			self.drivers[&#39;ap&#39;]=None</span>

<span class="sd">		def populate():</span>
<span class="sd">			super(HWMRun,self).populate()</span>
<span class="sd">			</span>
<span class="sd">			self.winds,self.drivers = hwmpy.hwm(self.flatlat,self.flatlon,self.flatalt,**self.drivers)</span>
<span class="sd">			</span>
<span class="sd">			#Now add all the zonal and meridional winds to the dictionary</span>
<span class="sd">			for w in self.winds:</span>
<span class="sd">				self.vars[w] = self.winds[w]</span>

<span class="sd">			#Now make everything into the appropriate shape, if were</span>
<span class="sd">			#expecting grids. Otherwise make everything into a column vector</span>
<span class="sd">			if self.shape is None:</span>
<span class="sd">				self.shape = (self.npts,1)</span>
<span class="sd">				</span>
<span class="sd">			for v in self.vars:</span>
<span class="sd">				self.vars[v] = np.reshape(self.vars[v],self.shape)</span>
<span class="sd">				if v not in [&#39;Latitude&#39;,&#39;Longitude&#39;,&#39;Altitude&#39;]:</span>
<span class="sd">					self.lims[v] = [np.nanmin(self.vars[v].flatten()),np.nanmax(self.vars[v].flatten())]</span>

<span class="sd">	**Operation works like this:**</span>
<span class="sd">		* Assume that we have a model run subclass call MyModel</span>
<span class="sd">		* Assume we have an instance of MyModel called mm </span>
<span class="sd">		</span>
<span class="sd">		#. User (or calling method) decides that they want:</span>
<span class="sd">			* To plot a GLOBAL grid at an altitude of 110km that is Latitude (50 pts) vs. Longitude (75 pts) vs. Model output</span>
<span class="sd">		#. They set mm.npts[&#39;Latitude&#39;]=50 and mm.npts[&#39;Longitude&#39;]=75 to tell the object what the size of the grid is</span>
<span class="sd">		#. They call mm.set_x(&#39;Latitude&#39;), and mm.set_y(&#39;Longitude&#39;) to set which dimensions correspond to which variables</span>
<span class="sd">		#. Since the model also requires an altitude value, they must set mm.vars[&#39;Altitude&#39;]=110 </span>
<span class="sd">		#. Since they want the grid to be global they set mm.lims[&#39;Latitude&#39;]=[-90.,90.] and mm.lims[&#39;Longitude&#39;]=[-180.,180.]</span>
<span class="sd">		#. Then they call mm.populate() to call the model for their desired grid</span>

<span class="sd">	**Calling:**</span>
<span class="sd">		* Getting a value from the ModelRun instance as if it were a dictionary i.e. mm[&#39;Latitude&#39;], returns data,limits for </span>
<span class="sd">			the variable &#39;Latitude&#39;. Handles differencing any non position variables with another ModelRun instance at mm.peer if mm.peer is not None</span>

<span class="sd">	**Peering:**</span>
<span class="sd">		* the peer parameter can be set to another ModelRun instance to return difference between variables in two runs</span>
<span class="sd">		TODO: Document peering </span>

<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		
		
		<span class="c">#Attributes which control how we do gridding</span>
		<span class="c">#if only one is &gt; 1, then we do vectors</span>
		<span class="c">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">modelname</span> <span class="o">=</span> <span class="bp">None</span>

		<span class="c">#Determines grid shape</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xkey</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ykey</span> <span class="o">=</span> <span class="bp">None</span>

		<span class="c">#if two are &gt; 1, then we do a grid</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="s">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="s">&#39;Altitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
		
		<span class="c">#the cannocical &#39;vars&#39; dictionary, which has </span>
		<span class="c">#keys which are used to populate the combobox widgets,</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Altitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>

		<span class="c">#the limits dictionary serves two purposes, </span>
		<span class="c">#1.) to constrain axes in the plots</span>
		<span class="c">#2.) to determine the variable boundaries when we&#39;re generating ranges of locations</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lims</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">90.</span><span class="p">,</span><span class="mf">90.</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="s">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="s">&#39;Altitude&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">400.</span><span class="p">]</span>
		
		<span class="c">#The drivers dictionary take input about whatever solar wind parameters drive the model</span>
		<span class="c">#These must be either scalars (floats) or lists.</span>
		<span class="c">#The keys to this dict must be keyword argument names in the model call </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">drivers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">None</span> <span class="c">#Tells how to produce gridded output, defaults (if None) to use column vectors</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">totalpts</span> <span class="o">=</span> <span class="bp">None</span> <span class="c">#Tells how many total points</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">peer</span> <span class="o">=</span> <span class="bp">None</span> <span class="c">#Can be either None, or another ModelRun, allows for comparing two runs</span>

<div class="viewcode-block" id="ModelRun.hold_constant"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.ModelRun.hold_constant">[docs]</a>	<span class="k">def</span> <span class="nf">hold_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Holds an ephem variable constant by ensuring it&#39;s npts is 1s&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">,</span><span class="s">&#39;Longitude&#39;</span><span class="p">,</span><span class="s">&#39;Altitude&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Cannot hold </span><span class="si">%s</span><span class="s"> constant, not a variable!&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ModelRun.set_x"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.ModelRun.set_x">[docs]</a>	<span class="k">def</span> <span class="nf">set_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Sets an emphem variable as x&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">,</span><span class="s">&#39;Longitude&#39;</span><span class="p">,</span><span class="s">&#39;Altitude&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">xkey</span> <span class="o">=</span> <span class="n">key</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Cannot set </span><span class="si">%s</span><span class="s"> as x, not a variable!&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="ModelRun.set_y"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.ModelRun.set_y">[docs]</a>	<span class="k">def</span> <span class="nf">set_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Sets an emphem variable as y&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">,</span><span class="s">&#39;Longitude&#39;</span><span class="p">,</span><span class="s">&#39;Altitude&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ykey</span> <span class="o">=</span> <span class="n">key</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Cannot set </span><span class="si">%s</span><span class="s"> as y, not a variable!&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</div>
	<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">alt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="k">pass</span>

<div class="viewcode-block" id="ModelRun.populate"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.ModelRun.populate">[docs]</a>	<span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Populates itself with data&quot;&quot;&quot;</span>
		<span class="c">#Make sure that everything has the same shape (i.e. either a grid or a vector of length self.npts)</span>

		<span class="c">#Count up the number of independant variables</span>
		<span class="n">nindependent</span><span class="o">=</span><span class="mi">0</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">nindependent</span><span class="o">+=</span><span class="mi">1</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">nindependent</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="c">#If gridding set the shape</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">]))</span>

		<span class="c">#Populate the ephemeris variables as vectors</span>
		<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">,</span><span class="s">&#39;Longitude&#39;</span><span class="p">,</span><span class="s">&#39;Altitude&#39;</span><span class="p">]:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Set </span><span class="si">%s</span><span class="s"> to something first if you want to hold it constant.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">var</span><span class="p">))</span>
			

		<span class="k">if</span> <span class="n">nindependent</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
			<span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">]</span>
			<span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">]</span>
			<span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span>

		<span class="c">#Now flatten everything to make the model call</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">flatlat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">flatlon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">flatalt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Altitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">totalpts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatlat</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ModelRun.finalize"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.ModelRun.finalize">[docs]</a>	<span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Call after populate to finish shaping the data and filling the lims dict</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c">#Now make everything into the appropriate shape, if were</span>
		<span class="c">#expecting grids. Otherwise make everything into a column vector</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
			
		<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">v</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">,</span><span class="s">&#39;Longitude&#39;</span><span class="p">,</span><span class="s">&#39;Altitude&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())]</span>
</div>
	<span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Gives a description of the model settings used to make this run</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;Model: </span><span class="si">%s</span><span class="s">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelname</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">+</span><span class="s">&quot;Dimension 1 </span><span class="si">%s</span><span class="s">: [</span><span class="si">%.3f</span><span class="s">-</span><span class="si">%.3f</span><span class="s">]|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ykey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">+</span><span class="s">&quot;Dimension 2 </span><span class="si">%s</span><span class="s">: [</span><span class="si">%.3f</span><span class="s">-</span><span class="si">%.3f</span><span class="s">]|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
		<span class="k">if</span> <span class="s">&#39;Latitude&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">]:</span>
			<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">+</span><span class="s">&quot;Latitude held constant at </span><span class="si">%.3f</span><span class="s">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="c">#By this point they will be arrays</span>
		<span class="k">if</span> <span class="s">&#39;Longitude&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">]:</span>
			<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">+</span><span class="s">&quot;Longitude held constant at </span><span class="si">%.3f</span><span class="s">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">if</span> <span class="s">&#39;Altitude&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xkey</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ykey</span><span class="p">]:</span>
			<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">+</span><span class="s">&quot;Altitude held constant at </span><span class="si">%.3f</span><span class="s">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Altitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">:</span>
			<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">+</span><span class="s">&quot;Driver </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">|&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>
		<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">+</span><span class="s">&quot;Generated at: </span><span class="si">%s</span><span class="s">&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%c</span><span class="s">&#39;</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">mystr</span>


	<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Easy syntax for returning data&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span> <span class="c">#If key is a sequence of some kind</span>
			<span class="n">var</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">lim</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
				<span class="n">v</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
				<span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
				<span class="n">lim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">var</span><span class="p">,</span><span class="n">lim</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Latitude&#39;</span><span class="p">,</span><span class="s">&#39;Longitude&#39;</span><span class="p">,</span><span class="s">&#39;Altitude&#39;</span><span class="p">]:</span>
					<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;Entering difference mode for var </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">))</span>
					<span class="c">#Doesn&#39;t make sense to difference locations</span>
					<span class="n">mydata</span><span class="p">,</span><span class="n">mylims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
					<span class="n">peerdata</span><span class="p">,</span><span class="n">peerlims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peer</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="c">#oh look, recursion opportunity!</span>
					<span class="n">newdata</span> <span class="o">=</span> <span class="n">mydata</span><span class="o">-</span><span class="n">peerdata</span>
					<span class="n">newlims</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">newdata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">newdata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
					<span class="c">#newlims = lim_pad(newlims)</span>
					<span class="k">return</span> <span class="n">newdata</span><span class="p">,</span><span class="n">newlims</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lims</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="HWMRun"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.HWMRun">[docs]</a><span class="k">class</span> <span class="nc">HWMRun</span><span class="p">(</span><span class="n">ModelRun</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot; Class for individual calls to HWM &quot;&quot;&quot;</span>
	<span class="kn">import</span> <span class="nn">hwmpy</span>
	
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Start with a blank slate&quot;&quot;&quot;</span>
		<span class="c">#This syntax allows for multiple inheritance,</span>
		<span class="c">#we don&#39;t use it, but it&#39;s good practice to use this </span>
		<span class="c">#instead of ModelRun.__init__()</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">HWMRun</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
		<span class="c">#MSIS DRIVERS</span>
		<span class="c">#ap - float</span>
		<span class="c">#	daily AP magnetic index</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">modelname</span> <span class="o">=</span> <span class="s">&quot;Horizontal Wind Model 07 (HWM07)&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;ap&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
		
	<span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

		<span class="nb">super</span><span class="p">(</span><span class="n">HWMRun</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
		
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;Now runing HWM07 for </span><span class="si">%s</span><span class="s">...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%c</span><span class="s">&#39;</span><span class="p">)))</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;Driver dict is </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">)))</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">winds</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span> <span class="o">=</span> <span class="n">hwmpy</span><span class="o">.</span><span class="n">hwm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatlat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">flatlon</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">flatalt</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">)</span>
		
		<span class="c">#Now add all the zonal and meridional winds to the dictionary</span>
		<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">winds</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winds</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>

		<span class="c">#Finish reshaping the data</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

				<span class="c">#print &quot;%s:%s&quot; % (v,repr(self.lims[v]))</span>
			<span class="c">#print &quot;lims for var %s = [%f,%f]&quot; % (v,self.lims[v][0],self.lims[v][1])</span>
</div>
<div class="viewcode-block" id="MsisRun"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.MsisRun">[docs]</a><span class="k">class</span> <span class="nc">MsisRun</span><span class="p">(</span><span class="n">ModelRun</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot; Class for individual calls to NRLMSISE00 &quot;&quot;&quot;</span>
	<span class="kn">import</span> <span class="nn">msispy</span>
	
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Start with a blank slate&quot;&quot;&quot;</span>
		<span class="c">#This syntax allows for multiple inheritance,</span>
		<span class="c">#we don&#39;t use it, but it&#39;s good practice to use this </span>
		<span class="c">#instead of ModelRun.__init__()</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">MsisRun</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
		<span class="c">#MSIS DRIVERS</span>
		<span class="c">#f107 - float</span>
		<span class="c">#	daily f10.7 flux for previous day</span>
		<span class="c">#ap_daily - float</span>
		<span class="c">#	daily AP magnetic index</span>
		<span class="c">#f107a - optional,float</span>
		<span class="c">#	81 day average of f10.7 flux (centered on date)</span>
		<span class="c">#ap3 - optional, float</span>
		<span class="c">#	3 hour AP for current time</span>
		<span class="c">#ap33 - optional, float</span>
		<span class="c">#	3 hour AP for current time - 3 hours</span>
		<span class="c">#ap36 - optional, float</span>
		<span class="c">#	3 hour AP for current time - 6 hours</span>
		<span class="c">#ap39 - optional, float</span>
		<span class="c">#	3 hour AP for current time - 9 hours</span>
		<span class="c">#apa1233 - optional, float</span>
		<span class="c">#	Average of eight 3 hour AP indicies from 12 to 33 hrs prior to current time</span>
		<span class="c">#apa3657 </span>
		<span class="c">#	Average of eight 3 hour AP indices from 36 to 57 hours prior to current time</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">modelname</span> <span class="o">=</span> <span class="s">&quot;NRLMSISE00&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;f107&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;ap_daily&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;f107a&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>

	<span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

		<span class="nb">super</span><span class="p">(</span><span class="n">MsisRun</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
		
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;Now runing NRLMSISE00 for </span><span class="si">%s</span><span class="s">...</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%c</span><span class="s">&#39;</span><span class="p">)))</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;Driver dict is </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">)))</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">t_exo</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">t_alt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span> <span class="o">=</span> <span class="n">msispy</span><span class="o">.</span><span class="n">msis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flatlat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">flatlon</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">flatalt</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">drivers</span><span class="p">)</span>
		
		<span class="c">#Now add temperature the variables dictionary</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;T_exospheric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_exo</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s">&#39;Temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_alt</span>
		
		<span class="c">#Now add all of the different number and mass densities to to the vars dictionary</span>
		<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

	</div>
<div class="viewcode-block" id="ModelRunner"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.ModelRunner">[docs]</a><span class="k">class</span> <span class="nc">ModelRunner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot; Makes model calls &quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">canvas</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="s">&quot;msis&quot;</span><span class="p">):</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">canvas</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

		<span class="c">#Init the runs list (holds each run in sequence)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="c">#Start with a blank msis run</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">init_nextrun</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nextrun</span><span class="o">.</span><span class="n">drivers</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c">#Summer solstice</span>

		<span class="c">#Set counters</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">n_total_runs</span><span class="o">=</span><span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">n_max_runs</span><span class="o">=</span><span class="mi">10</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">_differencemode</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Init the property</span>

		<span class="c">#Create the dictionary that stores the settings for the next run</span>
		
	<span class="k">def</span> <span class="nf">init_nextrun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;msis&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nextrun</span> <span class="o">=</span> <span class="n">MsisRun</span><span class="p">()</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;hwm&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nextrun</span> <span class="o">=</span> <span class="n">HWMRun</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not a valid model to run&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c">#Add to runs list, create a new nextrun</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nextrun</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">init_nextrun</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">differencemode</span><span class="p">:</span>
			<span class="c">#Update the peering</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nextrun</span><span class="o">.</span><span class="n">peer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">peer</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">:</span>
				<span class="n">run</span><span class="o">.</span><span class="n">peer</span> <span class="o">=</span> <span class="bp">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">n_total_runs</span><span class="o">+=</span><span class="mi">1</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;Model run number </span><span class="si">%d</span><span class="s"> added.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_total_runs</span><span class="p">))</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">)</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">n_max_runs</span><span class="p">:</span>
			<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;Exceeded total number of stored runs </span><span class="si">%d</span><span class="s">. Run </span><span class="si">%d</span><span class="s"> removed&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_max_runs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_total_runs</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">n_max_runs</span><span class="p">))</span>

	<span class="c">#Implement a simple interface for retrieving data, which is opaque to whether or now we&#39;re differencing</span>
	<span class="c">#or which model we&#39;re using</span>
	<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Shorthand for self.runs[-1][key], which returns self.runs[-1].vars[key],self.runs[-1].lims[key]&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Shorthand for self.nextrun[key]=value&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nextrun</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">value</span>

	<span class="c">#Make a property for the difference mode turning on or off, which automatically updates the last run peer</span>
	<span class="nd">@property</span>
	<span class="k">def</span> <span class="nf">differencemode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_differencemode</span>

	<span class="nd">@differencemode.setter</span>
	<span class="k">def</span> <span class="nf">differencemode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boo</span><span class="p">):</span>
		<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span> <span class="s">&quot;Difference mode is now </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">boo</span><span class="p">)))</span>
		<span class="k">if</span> <span class="n">boo</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nextrun</span><span class="o">.</span><span class="n">peer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nextrun</span><span class="o">.</span><span class="n">peer</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_differencemode</span> <span class="o">=</span> <span class="n">boo</span>
		
</div>
<div class="viewcode-block" id="PlotDataHandler"><a class="viewcode-back" href="../arch_backend.html#atmodbackend.PlotDataHandler">[docs]</a><span class="k">class</span> <span class="nc">PlotDataHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">canvas</span><span class="p">,</span><span class="n">plottype</span><span class="o">=</span><span class="s">&#39;line&#39;</span><span class="p">,</span><span class="n">cscale</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">,</span><span class="n">mapproj</span><span class="o">=</span><span class="s">&#39;mill&#39;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Takes a singleMplCanvas instance to associate with</span>
<span class="sd">		and plot on</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">fig</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">ax</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">axpos</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
		<span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axpos</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c"># Get the extent of the bounding box for the canvas axes</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cbpos</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">map_lw</span><span class="o">=.</span><span class="mi">5</span> <span class="c">#Map linewidth</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="bp">None</span> <span class="c">#Place holder for map instance if we&#39;re plotting a map</span>
		<span class="c">#The idea is to have all plot settings described in this class,</span>
		<span class="c">#so that if we want to add a new plot type, we only need to modify </span>
		<span class="c">#this class</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">supported_projections</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;mill&#39;</span><span class="p">:</span><span class="s">&#39;Miller Cylindrical&#39;</span><span class="p">,</span><span class="s">&#39;moll&#39;</span><span class="p">:</span><span class="s">&#39;Mollweide&#39;</span><span class="p">,</span><span class="s">&#39;ortho&#39;</span><span class="p">:</span><span class="s">&#39;Orthographic&#39;</span><span class="p">}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plottypes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plottypes</span><span class="p">[</span><span class="s">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gridxy&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s">&#39;overplot_ready&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s">&#39;x_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;all&#39;</span><span class="p">],</span><span class="s">&#39;y_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;all&#39;</span><span class="p">],</span><span class="s">&#39;z_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;none&#39;</span><span class="p">]}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plottypes</span><span class="p">[</span><span class="s">&#39;pcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gridxy&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s">&#39;overplot_ready&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s">&#39;x_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;position&#39;</span><span class="p">],</span><span class="s">&#39;y_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;position&#39;</span><span class="p">],</span><span class="s">&#39;z_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;notposition&#39;</span><span class="p">]}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plottypes</span><span class="p">[</span><span class="s">&#39;map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gridxy&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s">&#39;overplot_ready&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s">&#39;x_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;Longitude&#39;</span><span class="p">],</span><span class="s">&#39;y_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;Latitude&#39;</span><span class="p">],</span><span class="s">&#39;z_allowed&#39;</span><span class="p">:[</span><span class="s">&#39;notposition&#39;</span><span class="p">]}</span>
		<span class="k">if</span> <span class="n">plottype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottypes</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Invalid plottype </span><span class="si">%s</span><span class="s">! Choose from </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plottype</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plottypes</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
		
		<span class="c">#Assign settings from input</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">plottype</span> <span class="o">=</span> <span class="n">plottype</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mapproj</span> <span class="o">=</span> <span class="n">mapproj</span> <span class="c"># Map projection for Basemap</span>
			
		<span class="c">#Init the data variables</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">clear_data</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">caption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c">#Generates a description of the graph</span>
		<span class="n">cap</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span> <span class="k">else</span> <span class="s">&quot;log(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">)))</span>
		<span class="n">cap</span> <span class="o">=</span> <span class="n">cap</span> <span class="o">+</span> <span class="s">&quot; vs. </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span> <span class="k">else</span> <span class="s">&quot;log(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">)))</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype</span> <span class="o">==</span> <span class="s">&#39;pcolor&#39;</span><span class="p">:</span>
			<span class="n">cap</span> <span class="o">=</span> <span class="s">&quot;Pseudocolor plot of &quot;</span><span class="o">+</span> <span class="n">cap</span> <span class="o">+</span> <span class="s">&quot; vs. </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span> <span class="k">else</span> <span class="s">&quot;log(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)))</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype</span> <span class="o">==</span> <span class="s">&#39;map&#39;</span><span class="p">:</span>
			<span class="n">cap</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> projection map of &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_projections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapproj</span><span class="p">])</span><span class="o">+</span> <span class="n">cap</span> <span class="o">+</span> \
					<span class="s">&quot; vs. </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span> <span class="k">else</span> <span class="s">&quot;log(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">cap</span>
			
	<span class="k">def</span> <span class="nf">clear_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span> <span class="c">#must be np.array</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span> <span class="c">#must be string</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span> <span class="c">#must be 2 element tuple</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Information about each plotted data</span>

	<span class="k">def</span> <span class="nf">associate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">varxyz</span><span class="p">,</span><span class="n">vardata</span><span class="p">,</span><span class="n">varname</span><span class="p">,</span><span class="n">varbounds</span><span class="p">,</span><span class="n">varlog</span><span class="p">,</span><span class="n">multi</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="c">#Sanity check </span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">multi</span><span class="p">:</span>
			<span class="n">thislen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vardata</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> 
			<span class="n">thisshape</span> <span class="o">=</span> <span class="n">vardata</span><span class="o">.</span><span class="n">shape</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">thislen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vardata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> 
			<span class="n">thisshape</span> <span class="o">=</span> <span class="n">vardata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
		
		<span class="c">#Check total number of points</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">thislen</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Variable </span><span class="si">%s</span><span class="s"> passed for axes </span><span class="si">%s</span><span class="s"> had wrong flat length, got </span><span class="si">%d</span><span class="s">, expected </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">varname</span><span class="p">,</span><span class="n">varaxes</span><span class="p">,</span>
					<span class="n">thislen</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">))</span>

		<span class="c">#Check shape</span>
			<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multix</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiy</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">]:</span>

				<span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">thisshape</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Variable </span><span class="si">%s</span><span class="s"> passed for axes </span><span class="si">%s</span><span class="s"> had mismatched shape, got </span><span class="si">%s</span><span class="s">, expected </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">varname</span><span class="p">,</span><span class="n">varaxes</span><span class="p">,</span>
						<span class="nb">str</span><span class="p">(</span><span class="n">thisshape</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>

		<span class="c">#Parse input and assign approriate variable</span>
		<span class="k">if</span> <span class="n">varxyz</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;X&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;xvar&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">vardata</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">xname</span> <span class="o">=</span> <span class="n">varname</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span> <span class="o">=</span> <span class="n">varbounds</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">xlog</span> <span class="o">=</span> <span class="n">varlog</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">xmulti</span> <span class="o">=</span> <span class="n">multi</span>
		<span class="k">elif</span> <span class="n">varxyz</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;Y&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;yvar&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">vardata</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">yname</span> <span class="o">=</span> <span class="n">varname</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span> <span class="o">=</span> <span class="n">varbounds</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="n">varlog</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ymulti</span> <span class="o">=</span> <span class="n">multi</span>
		<span class="k">elif</span> <span class="n">varxyz</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;zvar&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">vardata</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">zname</span> <span class="o">=</span> <span class="n">varname</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span> <span class="o">=</span> <span class="n">varbounds</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">zlog</span> <span class="o">=</span> <span class="n">varlog</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not a valid axes for plotting!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">varaxes</span><span class="p">)))</span>

		

	<span class="k">def</span> <span class="nf">compute_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype</span><span class="o">==</span><span class="s">&#39;line&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmulti</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Mean-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Median-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;StDev-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Mean-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">[</span><span class="n">n</span><span class="p">])]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Median-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">[</span><span class="n">n</span><span class="p">])]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;StDev-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">[</span><span class="n">n</span><span class="p">])]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymulti</span><span class="p">:</span>	
				<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Mean-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Median-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;StDev-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Mean-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">[</span><span class="n">n</span><span class="p">])]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Median-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">[</span><span class="n">n</span><span class="p">])]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;StDev-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">[</span><span class="n">n</span><span class="p">])]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype</span><span class="o">==</span><span class="s">&#39;map&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottypes</span><span class="o">==</span><span class="s">&#39;pcolor&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Mean-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Median-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;StDev-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype</span><span class="o">==</span><span class="s">&#39;map&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Geo-Integrated-</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">integrate_z</span><span class="p">()</span>
	
	<span class="k">def</span> <span class="nf">integrate_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c">#If x and y are longitude and latitude</span>
		<span class="c">#integrates z over the grid</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="o">==</span><span class="s">&#39;Longitude&#39;</span><span class="p">:</span>
			<span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="o">==</span><span class="s">&#39;Longitude&#39;</span><span class="p">:</span>
			<span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="o">==</span><span class="s">&#39;Latitude&#39;</span><span class="p">:</span>
			<span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="o">==</span><span class="s">&#39;Latitude&#39;</span><span class="p">:</span>
			<span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
		<span class="c">#a little hack to get the altitude</span>
		<span class="n">alt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">controlstate</span><span class="p">[</span><span class="s">&#39;alt&#39;</span><span class="p">]</span>
		<span class="n">r_km</span> <span class="o">=</span> <span class="mf">6371.2</span><span class="o">+</span><span class="n">alt</span>

		<span class="n">zee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
		<span class="n">zint</span> <span class="o">=</span> <span class="mf">0.</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">theta1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.</span><span class="o">-</span><span class="n">lat</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
			<span class="n">theta2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.</span><span class="o">-</span><span class="n">lat</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
			<span class="n">dphi</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lon</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
			<span class="n">zint</span> <span class="o">+=</span>  <span class="p">(</span><span class="n">zee</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">zee</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r_km</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">dphi</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)))</span><span class="c">#area element</span>
		<span class="k">return</span> <span class="n">zint</span>

	<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		


		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="bp">None</span> <span class="c">#Make sure that we don&#39;t leave any maps lying around if we&#39;re not plotting maps</span>
		
		<span class="c">#print &quot;self.ax: %s\n&quot; % (str(self.ax.get_position()))</span>

		<span class="c">#print &quot;All axes: \n&quot; </span>
		<span class="c">#for i,a in enumerate(self.fig.axes):</span>
		<span class="c">#	print &quot;%d: %s&quot; % (i,str(a.get_position()))</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistics</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">compute_statistics</span><span class="p">()</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="c">#logging.info(&quot;removing self.cb:%s\n&quot; % (str(self.cb.ax.get_position())))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">None</span>


		<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

		<span class="c">#self.zbounds = (np.nanmin(self.z),np.nanmax(self.z))</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">&lt;=</span><span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
			<span class="n">norm</span> <span class="o">=</span> <span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 
			<span class="n">locator</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">()</span>
			<span class="n">formatter</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">LogFormatter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelOnlyBase</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> 
		<span class="k">else</span><span class="p">:</span>
			<span class="n">norm</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype</span> <span class="o">==</span> <span class="s">&#39;line&#39;</span><span class="p">:</span>
			<span class="c">#Plot a simple 2d line plot</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">None</span>
				<span class="c">#self.ax.set_position(self.axpos)</span>

			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmulti</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymulti</span><span class="p">:</span> <span class="c">#No overplotting</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
				<span class="n">xbnds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span>
				<span class="n">ybnds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span>
				<span class="n">xnm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xname</span>
				<span class="n">ynm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yname</span>

			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmulti</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymulti</span><span class="p">:</span> <span class="c">#Overplotting xvars</span>
			
				<span class="n">xbnds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">ybnds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span>
				<span class="n">xnm</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
				<span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">:</span>
					<span class="n">xnm</span> <span class="o">+=</span> <span class="n">nm</span><span class="o">+</span><span class="s">&#39;,&#39;</span>
				<span class="n">xnm</span> <span class="o">=</span> <span class="n">xnm</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c">#Remove last comma</span>
				<span class="k">print</span> <span class="n">xnm</span>
				<span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span>

				<span class="n">ynm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yname</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c">#should cycle through colors</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
					
					<span class="c">#Compute new bounds as incuding all bounds</span>
					<span class="n">xbnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xbnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">xbnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
					<span class="n">xbnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xbnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">xbnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymulti</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmulti</span><span class="p">:</span> <span class="c">#Overplotting yvars</span>
				<span class="n">ybnds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">xbnds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span>
				<span class="n">xnm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xname</span>
				<span class="n">ynm</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
				<span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">:</span>
					<span class="n">ynm</span> <span class="o">+=</span> <span class="n">nm</span><span class="o">+</span><span class="s">&#39;,&#39;</span>
				<span class="n">ynm</span> <span class="o">=</span> <span class="n">ynm</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c">#Remove last comma</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c">#should cycle through colors</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
					<span class="c">#Compute new bounds as incuding all bounds</span>
					
					<span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
					<span class="n">ybnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ybnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">ybnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
					<span class="n">ybnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ybnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">ybnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

			<span class="c">#Set axes appearance and labeling</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xnm</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">,</span><span class="n">nonposx</span><span class="o">=</span><span class="s">&#39;clip&#39;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">get_major_formatter</span><span class="p">()</span><span class="o">.</span><span class="n">labelOnlyBase</span> <span class="o">=</span> <span class="bp">False</span>
				
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xbnds</span><span class="p">)</span>
			
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ynm</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">,</span><span class="n">nonposx</span><span class="o">=</span><span class="s">&#39;clip&#39;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">get_major_formatter</span><span class="p">()</span><span class="o">.</span><span class="n">labelOnlyBase</span> <span class="o">=</span> <span class="bp">False</span>
				
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ybnds</span><span class="p">)</span>
			
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmulti</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymulti</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

				<span class="c">#self.ax.set_ylim(0,np.log(self.ybounds[1]))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> vs. </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xnm</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span> <span class="k">else</span> <span class="s">&#39;log(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xnm</span><span class="p">),</span><span class="n">ynm</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span> <span class="k">else</span> <span class="s">&#39;log(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ynm</span><span class="p">)))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_data_ratio</span><span class="p">())</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span><span class="o">.</span><span class="mi">75</span><span class="p">,</span><span class="o">.</span><span class="mi">75</span><span class="p">])</span>
			<span class="c">#try:</span>
			<span class="c">#	self.fig.tight_layout()</span>
			<span class="c">#except:</span>
			<span class="c">#	print &quot;Tight layout for line failed&quot;</span>
		
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype</span> <span class="o">==</span> <span class="s">&#39;pcolor&#39;</span><span class="p">:</span>
			
			<span class="n">mappable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">shading</span><span class="o">=</span><span class="s">&#39;gouraud&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="c">#m.draw()</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">,</span><span class="n">nonposx</span><span class="o">=</span><span class="s">&#39;clip&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">)</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">)</span>
			
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">,</span><span class="n">nonposx</span><span class="o">=</span><span class="s">&#39;clip&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">)</span>
			
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span><span class="p">:</span> <span class="c">#Locator goes to ticks argument</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="n">locator</span><span class="p">)</span>

			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">)</span>

			<span class="c">#self.ax.set_position(self.axpos)</span>
			<span class="c">#self.cb.ax.set_position(self.cbpos)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">15</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">])</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_data_ratio</span><span class="p">())</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> vs. </span><span class="si">%s</span><span class="s"> (color:</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">yname</span><span class="p">,</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">zname</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span> <span class="k">else</span> <span class="s">&#39;log(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">))</span>
			
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype</span> <span class="o">==</span> <span class="s">&#39;map&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapproj</span><span class="o">==</span><span class="s">&#39;moll&#39;</span><span class="p">:</span>
				<span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapproj</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
					<span class="n">llcrnrlon</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">urcrnrlon</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">lat_ts</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">lon_0</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapproj</span><span class="o">==</span><span class="s">&#39;mill&#39;</span><span class="p">:</span>
				<span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapproj</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
					<span class="n">llcrnrlon</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">urcrnrlon</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">lat_ts</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapproj</span><span class="o">==</span><span class="s">&#39;ortho&#39;</span><span class="p">:</span>
				<span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;ortho&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">lat_0</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">controlstate</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">]),</span>
					<span class="n">lon_0</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">controlstate</span><span class="p">[</span><span class="s">&#39;lon&#39;</span><span class="p">]),</span><span class="n">resolution</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">)</span>
			
			<span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map_lw</span><span class="p">)</span>

			<span class="c">#m.fillcontinents(color=&#39;coral&#39;,lake_color=&#39;aqua&#39;)</span>
			
			<span class="c"># draw parallels and meridians.</span>
			<span class="n">m</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">90.</span><span class="p">,</span><span class="mf">91.</span><span class="p">,</span><span class="mf">15.</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map_lw</span><span class="p">)</span>
			<span class="n">m</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span><span class="mf">181.</span><span class="p">,</span><span class="mf">30.</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">map_lw</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span><span class="p">:</span>
				<span class="n">mappable</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">latlon</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
					<span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">shading</span><span class="o">=</span><span class="s">&#39;gouraud&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">mappable</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">latlon</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
					<span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">shading</span><span class="o">=</span><span class="s">&#39;gouraud&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
				
			
			<span class="n">latbounds</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ybounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
			<span class="n">lonbounds</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">xbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

			<span class="n">lonbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">latbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lonbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">latbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">lonbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">latbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lonbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">latbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

			<span class="c">#self.ax.set_ylim(latbounds)</span>
			<span class="c">#self.ax.set_xlim(lonbounds)</span>

			<span class="c">#m.draw()</span>


			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="n">locator</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">)</span>

			<span class="c">#m.set_axes_limits(ax=self.canvas.ax)</span>
			
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lonbounds</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">latbounds</span><span class="p">)</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mo">05</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">15</span><span class="p">])</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">])</span>

			<span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> Projection Map of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_projections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapproj</span><span class="p">],</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">zname</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlog</span> <span class="k">else</span> <span class="s">&#39;log(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zname</span><span class="p">)))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">m</span>
		<span class="c">#Now call the canvas cosmetic adjustment routine</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">apply_lipstick</span><span class="p">()</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">AtModExplorer 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Liam Kilcommons.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>